
{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="logout-button">
        {% if user.is_authenticated %}
            <a href="{% url 'authapp:login' %}" class="btn btn-primary">logout</a>
        {% endif %}
    </div>
    <div class="row">
        <div class="col-md-12">
            <h1>Service Desk</h1>
            <br>
            <div class="speech-bubble">
                <p>Hello, {{ user_name }}. My name is Wesly! How can I help you today?</p>
            </div>
            <br><br>
            <form id="input-form">
                <div class="text-box">
                    <input type="text" id="ask-text" placeholder="Ask me for something" class="large-text-box">
                    <button type="submit">Submit</button>
                </div>
                
                <div id="result-container"></div>

            </form>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {

        // Get the CSRF token from the cookie
        var csrftoken = getCookie('csrftoken');

        // Handle form submission
        $("#input-form").on("submit", function (event) {
            event.preventDefault();  // Prevent the default form submission

            // Get the user input
            var userInput = $("#ask-text").val();

            // Send an AJAX request to your Django view
            $.ajax({
                url: "{% url 'authapp:process_input' %}",  // Replace 'process_input' with your actual URL
                method: "POST",
                data: { input_text: userInput },
                beforeSend: function (xhr) {
                    // Include the CSRF token in the request header
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                },
                success: function (data) {
                    // Display the result in the result-container div
                    $("#result-container").html(data.result);
                },
                error: function () {
                    // Handle any errors here
                    alert("An error occurred while processing your request.");
                },
            });
        });

        // Function to retrieve the CSRF token from the cookie
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = $.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
</script>


{% endblock %}
